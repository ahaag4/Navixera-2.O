<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Live Public Transit Dashboard — Navixera</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">

  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin=""/>
  
  <link rel="stylesheet" href="assets/css/index.css">
  <script src="https://js.stripe.com/v3/"></script>
</head>
<body>
  <!-- Flash Screen -->
  <div id="flashScreen" class="flash-screen">
    <div class="logo-container">
      <svg xmlns="http://www.w3.org/2000/svg" width="100" height="100" fill="currentColor" class="bi bi-broadcast-pin" viewBox="0 0 16 16">
        <path d="M3.05 3.05a7 7 0 0 0 0 9.9.5.5 0 0 1-.707.707 8 8 0 0 1 0-11.314.5.5 0 0 1 .707.707zm2.122 2.122a4 4 0 0 0 0 5.656.5.5 0 1 1-.708.708 5 5 0 0 1 0-7.072.5.5 0 0 1 .708.708zm5.656-.708a.5.5 0 0 1 .708 0 5 5 0 0 1 0 7.072.5.5 0 1 1-.708-.708 4 4 0 0 0 0-5.656.5.5 0 0 1 0-.708zm2.122-2.12a.5.5 0 0 1 .707 0 8 8 0 0 1 0 11.314.5.5 0 0 1-.707-.707 7 7 0 0 0 0-9.9.5.5 0 0 1 0-.707zM8 10a2 2 0 1 1 0-4 2 2 0 0 1 0 4z"/>
        <path d="M12.06 13.94a.5.5 0 0 1 .707 0l1.414 1.414a.5.5 0 0 1-.707.707L12.06 14.647a.5.5 0 0 1 0-.707zM4.646 13.94a.5.5 0 0 0-.707 0L2.525 15.354a.5.5 0 0 0 .707.707L4.646 14.647a.5.5 0 0 0 0-.707zM8 16s6-5.686 6-10A6 6 0 0 0 2 6c0 4.314 6 10 6 10zM8 9a3 3 0 1 1 0-6 3 3 0 0 1 0 6z"/>
      </svg>
      <h1>Navixera</h1>
    </div>
  </div>

  <nav class="navbar navbar-expand-lg shadow-sm">
    <div class="container">
      <a class="navbar-brand" href="#">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="bi bi-broadcast-pin" viewBox="0 0 16 16" style="margin-right: 8px;">
          <path d="M3.05 3.05a7 7 0 0 0 0 9.9.5.5 0 0 1-.707.707 8 8 0 0 1 0-11.314.5.5 0 0 1 .707.707zm2.122 2.122a4 4 0 0 0 0 5.656.5.5 0 1 1-.708.708 5 5 0 0 1 0-7.072.5.5 0 0 1 .708.708zm5.656-.708a.5.5 0 0 1 .708 0 5 5 0 0 1 0 7.072.5.5 0 1 1-.708-.708 4 4 0 0 0 0-5.656.5.5 0 0 1 0-.708zm2.122-2.12a.5.5 0 0 1 .707 0 8 8 0 0 1 0 11.314.5.5 0 0 1-.707-.707 7 7 0 0 0 0-9.9.5.5 0 0 1 0-.707zM8 10a2 2 0 1 1 0-4 2 2 0 0 1 0 4z"/>
          <path d="M12.06 13.94a.5.5 0 0 1 .707 0l1.414 1.414a.5.5 0 0 1-.707.707L12.06 14.647a.5.5 0 0 1 0-.707zM4.646 13.94a.5.5 0 0 0-.707 0L2.525 15.354a.5.5 0 0 0 .707.707L4.646 14.647a.5.5 0 0 0 0-.707zM8 16s6-5.686 6-10A6 6 0 0 0 2 6c0 4.314 6 10 6 10zM8 9a3 3 0 1 1 0-6 3 3 0 0 1 0 6z"/>
        </svg>
        Navixera — Live Transit
      </a>
      <div class="d-flex align-items-center">
        <span class="badge bg-primary me-2">Live</span>
        <small class="text-muted d-none d-md-block">AI-Powered Transit Tracking</small>
      </div>
      <div id="authSection" class="ms-auto d-flex align-items-center gap-2">
        <button id="loginBtn" class="btn btn-outline-primary">Login</button>
        <div id="profileSection" class="d-none">
          <div class="dropdown">
            <button class="btn btn-outline-secondary dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false">
              <i class="bi bi-person-circle"></i> Profile
            </button>
            <ul class="dropdown-menu">
              <li><a class="dropdown-item" href="#" id="editProfileBtn">Edit Profile</a></li>
              <li><a class="dropdown-item" href="#" id="logoutBtn">Logout</a></li>
              <li><a class="dropdown-item" href="#" id="historyBtn">History</a></li>
            </ul>
          </div>
        </div>
      </div>
      <select id="languageSelect" class="form-select ms-2" style="width: auto;">
        <option value="en">English</option>
        <option value="hi">Hindi</option>
        <option value="fr">French</option>
        <option value="as">Assamese</option>
        <option value="bn">Bengali</option>
        <option value="gu">Gujarati</option>
        <option value="kn">Kannada</option>
        <option value="ks">Kashmiri</option>
        <option value="kok">Konkani</option>
        <option value="ml">Malayalam</option>
        <option value="mni">Manipuri</option>
        <option value="mr">Marathi</option>
        <option value="ne">Nepali</option>
        <option value="or">Odia</option>
        <option value="pa">Punjabi</option>
        <option value="sa">Sanskrit</option>
        <option value="sd">Sindhi</option>
        <option value="ta">Tamil</option>
        <option value="te">Telugu</option>
        <option value="ur">Urdu</option>
        <option value="brx">Bodo</option>
        <option value="sat">Santhali</option>
        <option value="mai">Maithili</option>
        <option value="doi">Dogri</option>
      </select>
    </div>
  </nav>

  <main class="container my-4">
    <div class="row g-4">
      <div class="col-12 col-lg-8">
        <div class="card map-card">
          <div id="map"></div>
          <div class="map-controls">
            <button id="locateBtn" class="btn btn-light" title="Find My Location">
              <i class="bi bi-geo-alt-fill text-primary"></i>
            </button>
            <button id="showBusStopsBtn" class="btn btn-light" title="Show Bus Stops">
              <i class="bi bi-signpost text-primary"></i>
            </button>
            <button id="lostBagBtn" class="btn btn-light" title="Report Lost Bag" data-bs-toggle="modal" data-bs-target="#lostBagModal">
              <i class="bi bi-bag-x text-danger"></i>
            </button>
            <button id="safetyBtn" class="btn btn-light" title="Safety Alert">
              <i class="bi bi-shield-fill-exclamation text-danger"></i>
            </button>
            <button id="buyTicketBtn" class="btn btn-light" title="Buy Ticket" data-bs-toggle="modal" data-bs-target="#buyTicketModal">
              <i class="bi bi-ticket-perforated text-success"></i>
            </button>
            <button id="chatBtn" class="btn btn-light" title="Chat" data-bs-toggle="modal" data-bs-target="#chatModal">
              <i class="bi bi-chat-dots text-info"></i>
            </button>
          </div>
          <div class="loader-overlay" id="loader">
            <div class="spinner-border text-primary" role="status">
              <span class="visually-hidden">Loading...</span>
            </div>
          </div>
        </div>
      </div>
      <div class="col-12 col-lg-4">
        <div class="card search-panel">
          <h5 class="card-title mb-3">Find Your Ride</h5>
          <div class="search-group">
            <label for="searchVehicle" class="form-label fw-medium">Vehicle Number</label>
            <input type="text" id="searchVehicle" class="form-control" placeholder="e.g., MH-01-AB-1234">
            <button id="searchVehicleBtn" class="btn btn-primary w-100 mt-2">
              <i class="bi bi-search"></i> Search Vehicle
            </button>
          </div>
          <div class="divider"></div>
          <div class="search-group">
            <label for="searchRouteFrom" class="form-label fw-medium">Route Planner</label>
            <input type="text" id="searchRouteFrom" class="form-control" placeholder="From (e.g., Central Station)">
            <input type="text" id="searchRouteTo" class="form-control mt-2" placeholder="To (e.g., North Park)">
            <button id="searchRouteBtn" class="btn btn-primary w-100 mt-2">
              <i class="bi bi-signpost-split"></i> Find Route
            </button>
          </div>
          
          <!-- Bus Alert Section -->
          <div class="divider"></div>
          <div class="search-group">
            <label class="form-label fw-medium">Bus Arrival Alerts</label>
            <select id="busAlertSelect" class="form-select">
              <option value="">Select a bus to track</option>
            </select>
            <button id="setAlertBtn" class="btn btn-warning w-100 mt-2">
              <i class="bi bi-bell"></i> Set Arrival Alert
            </button>
          </div>
          
          <div class="mt-auto">
            <h6 class="fw-medium mb-2">Search Results</h6>
            <div class="result-list" id="searchResults">
              <div class="text-center p-3 text-muted">
                <i class="bi bi-inbox d-block fs-1 mb-2"></i>
                <span>Your search results will appear here</span>
              </div>
            </div>
          </div>
          <!-- Points Section -->
          <div class="divider"></div>
          <div class="search-group" id="pointsSection" style="display: none;">
            <h6 class="fw-medium mb-2">Your Points: <span id="userPoints">0</span></h6>
            <button id="dailyCheckInBtn" class="btn btn-success w-100">Daily Check-In</button>
          </div>
        </div>
      </div>
    </div>
  </main>

  <div class="card sidebar" id="vehicleDetails">
    <div class="card-header d-flex justify-content-between align-items-center">
      <h5 class="card-title mb-0" id="vehicleTitle">Vehicle Details</h5>
      <button type="button" the btn-close" aria-label="Close" id="closeSidebarBtn"></button>
    </div>
    <div class="card-body">
      <div id="vehicleInfo" class="mb-3"></div>
      <h6 class="fw-medium mb-3">Route Stops</h6>
      <ul id="stopList" class="list-group list-group-flush"></ul>
      <!-- Progress Bar -->
      <div class="mt-3">
        <h6 class="fw-medium mb-2">Bus Progress</h6>
        <div class="progress" id="busProgress">
          <div class="progress-bar" role="progressbar" style="width: 0%;" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100">0%</div>
        </div>
      </div>
    </div>
  </div>

  <div class="card bus-stop-panel" id="busStopPanel">
    <div class="card-header d-flex justify-content-between align-items-center">
      <h5 class="card-title mb-0">Nearest Bus Stop</h5>
      <button type="button" class="btn-close" aria-label="Close" id="closeBusStopPanelBtn"></button>
    </div>
    <div class="card-body" id="busStopContent">
      <!-- Dynamically populated -->
    </div>
  </div>

  <!-- Lost Bag Modal -->
  <div class="modal fade" id="lostBagModal" tabindex="-1" aria-labelledby="lostBagModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="lostBagModalLabel">Report Lost Bag</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <p>If you've forgotten your bag on a bus, we can notify the driver. This only works when you're near the bus.</p>
          <div class="mb-3">
            <label for="lostBagBusSelect" class="form-label">Select Bus</label>
            <select class="form-select" id="lostBagBusSelect">
              <option value="">Select the bus you were on</option>
            </select>
          </div>
          <div class="mb-3">
            <label for="bagDescription" class="form-label">Bag Description</label>
            <textarea class="form-control" id="bagDescription" rows="3" placeholder="Describe your bag (color, size, distinctive features)"></textarea>
          </div>
          <div class="form-check mb-3">
            <input class="form-check-input" type="checkbox" id="confirmLocation">
            <label class="form-check-label" for="confirmLocation">
              I confirm I'm currently near this bus
            </label>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
          <button type="button" class="btn btn-danger" id="reportLostBagBtn">Report Lost Bag</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Buy Ticket Modal -->
  <div class="modal fade" id="buyTicketModal" tabindex="-1" aria-labelledby="buyTicketModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="buyTicketModalLabel">Buy Ticket</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <div class="mb-3">
            <label for="ticketFrom" class="form-label">From</label>
            <input type="text" class="form-control" id="ticketFrom" placeholder="Enter starting point">
          </div>
          <div class="mb-3">
            <label for="ticketTo" class="form-label">To</label>
            <input type="text" class="form-control" id="ticketTo" placeholder="Enter destination">
          </div>
          <div class="mb-3">
            <label for="ticketBusSelect" class="form-label">Select Bus</label>
            <select class="form-select" id="ticketBusSelect">
              <option value="">Select a bus</option>
            </select>
          </div>
          <div class="mb-3" id="pointsRedeemSection" style="display: none;">
            <label for="usePoints" class="form-label">Use Points for Discount</label>
            <input type="number" class="form-control" id="usePoints" min="0" placeholder="Enter points to use">
          </div>
          <p>Total Amount: <span id="ticketAmount">100</span> (USD)</p>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
          <button type="button" class="btn btn-success" id="payTicketBtn">Pay Now</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Edit Profile Modal -->
  <div class="modal fade" id="editProfileModal" tabindex="-1" aria-labelledby="editProfileModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="editProfileModalLabel">Edit Profile</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <div class="mb-3">
            <label for="profileName" class="form-label">Name</label>
            <input type="text" class="form-control" id="profileName" placeholder="Enter name">
          </div>
          <div class="mb-3">
            <label for="profileEmail" class="form-label">Email</label>
            <input type="email" class="form-control" id="profileEmail" placeholder="Enter email" disabled>
          </div>
          <div class="mb-3">
            <label for="emergencyContacts" class="form-label">Emergency Contacts (comma-separated)</label>
            <input type="text" class="form-control" id="emergencyContacts" placeholder="e.g., +1234567890, +0987654321">
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
          <button type="button" class="btn btn-primary" id="saveProfileBtn">Save</button>
        </div>
      </div>
    </div>
  </div>

  <!-- History Modal -->
  <div class="modal fade" id="historyModal" tabindex="-1" aria-labelledby="historyModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="historyModalLabel">Transaction History</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <ul id="historyList" class="list-group"></ul>
        </div>
      </div>
    </div>
  </div>

  <!-- Chat Modal -->
  <div class="modal fade" id="chatModal" tabindex="-1" aria-labelledby="chatModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="chatModalLabel">Bus Chat</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <select id="chatBusSelect" class="form-select mb-3">
            <option value="">Select Bus to Chat</option>
          </select>
          <div id="chatMessages" class="border p-3 mb-3" style="height: 200px; overflow-y: auto;"></div>
          <div class="input-group">
            <input type="text" id="chatInput" class="form-control" placeholder="Type message...">
            <button class="btn btn-primary" id="sendChatBtn">Send</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Feedback Modal -->
  <div class="modal fade" id="feedbackModal" tabindex="-1" aria-labelledby="feedbackModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="feedbackModalLabel">Feedback</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <textarea class="form-control" id="feedbackText" rows="3" placeholder="Your feedback..."></textarea>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
          <button type="button" class="btn btn-primary" id="submitFeedbackBtn">Submit</button>
        </div>
      </div>
    </div>
  </div>

  <div class="toast-container"></div>

  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-functions-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
  <script src="https://cdn.jsdelivr.net/npm/leaflet-rotatedmarker@0.2.0/leaflet.rotatedMarker.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL" crossorigin="anonymous"></script>

  <script src="assets/js/index.js"></script>
</body>
  </html>
