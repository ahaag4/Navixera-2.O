<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Company Admin Panel — Navixera</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>

  <style>
    :root {
      --primary: #0d6efd;
      --muted: #6c757d;
      --card-bg: #fff;
      --page-bg: #f6f8fb;
    }
    html, body { height: 100%; margin: 0; }
    body { background: var(--page-bg); font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial; }
    .navbar { background: linear-gradient(90deg, var(--primary), #1a7bff); }
    .navbar-brand { color: #fff !important; font-weight: 600; }
    .card { border: 0; border-radius: 12px; box-shadow: 0 6px 18px rgba(13, 110, 253, 0.06); }
    .stat-card { padding: 18px; border-radius: 10px; background: var(--card-bg); text-align: center; }
    .stat-card h3 { margin: 0; color: var(--primary); font-weight: 700; }
    .small-muted { color: var(--muted); font-size: .9rem; }
    .controls-row > * { margin-right: .5rem; margin-bottom: .5rem; }
    .toast-container { position: fixed; top: 1rem; right: 1rem; z-index: 1080; }
    .stop-list { max-height: 200px; overflow-y: auto; }
    .table-responsive { max-height: 400px; overflow-y: auto; }
    .map-container { height: 300px; border-radius: 8px; margin-bottom: 1rem; }
    .is-invalid { border-color: #dc3545; }
    .invalid-feedback { display: block; color: #dc3545; font-size: 0.875rem; }
    .qr-wrapper { display:flex; gap:12px; align-items:center; flex-wrap:wrap; }
    .qr-canvas { background:#fff; padding:8px; border-radius:8px; box-shadow:0 4px 12px rgba(0,0,0,0.08); }
    @media (max-width: 992px) {
      .controls-row > * { margin-right: 0; }
    }
  </style>
</head>
<body>
  <nav class="navbar navbar-expand-lg mb-3">
    <div class="container">
      <a class="navbar-brand" href="#">Company Admin — Navixera</a>
      <div class="d-flex align-items-center ms-auto gap-2">
        <span id="currentUser" class="text-white small-muted"></span>
        <button id="logoutBtn" class="btn btn-light btn-sm">Logout</button>
      </div>
    </div>
  </nav>

  <main class="container mb-5">
    <div class="row g-3 mb-4">
      <div class="col-6 col-md-3">
        <div class="stat-card">
          <div class="small-muted">Companies</div>
          <h3 id="statCompanies">0</h3>
        </div>
      </div>
      <div class="col-6 col-md-3">
        <div class="stat-card">
          <div class="small-muted">Vehicles</div>
          <h3 id="statVehicles">0</h3>
        </div>
      </div>
      <div class="col-6 col-md-3">
        <div class="stat-card">
          <div class="small-muted">Active Deliveries</div>
          <h3 id="statDeliveries">0</h3>
        </div>
      </div>
      <div class="col-6 col-md-3">
        <div class="stat-card">
          <div class="small-muted">Alerts Today</div>
          <h3 id="statAlerts">0</h3>
        </div>
      </div>
    </div>

    <!-- Vehicle management card (same as earlier) -->
    <div class="card mb-4">
      <div class="card-body">
        <h5 class="card-title">Manage Public Vehicles (click map to set location)</h5>
        <div class="mb-3">
          <div id="vehicleMap" class="map-container"></div>
        </div>
        <div class="row controls-row">
          <div class="col-md-3">
            <input id="publicVehicleId" class="form-control" placeholder="Vehicle ID (e.g., MH-01-AB-1234)">
            <div class="invalid-feedback" id="vehicleIdFeedback"></div>
          </div>
          <div class="col-md-3">
            <input id="publicVehicleType" class="form-control" placeholder="Vehicle Type (e.g., Bus)">
            <div class="invalid-feedback" id="vehicleTypeFeedback"></div>
          </div>
          <div class="col-md-3">
            <input id="publicVehicleGps" class="form-control" placeholder="GPS (lat,lng)" readonly>
            <div class="invalid-feedback" id="gpsFeedback"></div>
          </div>
          <div class="col-md-3">
            <input id="publicRouteName" class="form-control" placeholder="Route Name (e.g., Route 101)">
            <div class="invalid-feedback" id="routeFeedback"></div>
          </div>
        </div>

        <div class="row controls-row mt-2">
          <div class="col-12">
            <h6>Add Stops (for route)</h6>
            <div class="mb-3">
              <div id="stopMap" class="map-container"></div>
            </div>
            <div class="input-group mb-2">
              <input id="stopName" class="form-control" placeholder="Stop Name">
              <input id="stopGps" class="form-control" placeholder="Stop GPS (lat,lng)" readonly>
              <button id="addStopBtn" class="btn btn-outline-primary">Add Stop</button>
            </div>
            <div class="invalid-feedback" id="stopFeedback"></div>
            <ul id="stopList" class="list-group stop-list"></ul>
          </div>
        </div>

        <div class="row controls-row mt-2">
          <div class="col-md-6">
            <button id="addPublicVehicleBtn" class="btn btn-primary">Add/Update Public Vehicle</button>
          </div>
          <div class="col-md-6 text-end">
            <button id="deletePublicVehicleBtn" class="btn btn-danger">Delete Public Vehicle</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Existing vehicles -->
    <div class="card mb-4">
      <div class="card-body">
        <h5 class="card-title">Existing Public Vehicles</h5>
        <button id="refreshVehiclesBtn" class="btn btn-secondary mb-2">Refresh List</button>
        <div class="table-responsive">
          <table class="table">
            <thead>
              <tr>
                <th>Vehicle ID</th>
                <th>Type</th>
                <th>Route</th>
                <th>Status</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody id="vehicleListTbody"></tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- Bus stop management -->
    <div class="card mb-4">
      <div class="card-body">
        <h5 class="card-title">Manage Bus Stops</h5>
        <div class="mb-3">
          <div id="busStopMap" class="map-container"></div>
        </div>
        <div class="row controls-row">
          <div class="col-md-3">
            <input id="stopId" class="form-control" placeholder="Stop ID (e.g., STOP001)">
            <div class="invalid-feedback" id="stopIdFeedback"></div>
          </div>
          <div class="col-md-3">
            <input id="stopNameInput" class="form-control" placeholder="Stop Name (e.g., Central Station)">
            <div class="invalid-feedback" id="stopNameFeedback"></div>
          </div>
          <div class="col-md-3">
            <input id="stopGpsInput" class="form-control" placeholder="GPS (lat,lng)" readonly>
            <div class="invalid-feedback" id="stopGpsFeedback"></div>
          </div>
          <div class="col-md-3">
            <input id="stopVehicleId" class="form-control" placeholder="Vehicle ID (optional)">
          </div>
        </div>

        <div class="row controls-row mt-2">
          <div class="col-md-3">
            <input id="stopVehicleRoute" class="form-control" placeholder="Route Name (optional)">
          </div>
          <div class="col-md-3">
            <input id="stopVehicleType" class="form-control" placeholder="Vehicle Type (e.g., AC)">
          </div>
          <div class="col-md-3">
            <input id="stopVehicleTimings" class="form-control" placeholder="Timings (e.g., Every 15 min)">
          </div>
          <div class="col-md-3">
            <button id="addStopVehicleBtn" class="btn btn-outline-primary">Add Vehicle to Stop</button>
          </div>
        </div>

        <div class="mt-2">
          <h6>Added Vehicles</h6>
          <ul id="stopVehicleList" class="list-group stop-list"></ul>
        </div>

        <div class="row controls-row mt-2">
          <div class="col-md-6">
            <button id="addBusStopBtn" class="btn btn-primary">Add/Update Bus Stop (Create QR)</button>
          </div>
          <div class="col-md-6 text-end">
            <button id="deleteBusStopBtn" class="btn btn-danger">Delete Bus Stop</button>
          </div>
        </div>

        <div class="mt-3" id="lastQrArea" style="display:none;">
          <h6>Last generated QR</h6>
          <div class="qr-wrapper">
            <div id="qrcode" class="qr-canvas"></div>
            <div>
              <div id="qrLink"></div>
              <div class="mt-2">
                <a id="downloadQrBtn" class="btn btn-outline-primary btn-sm" href="#" download="stop_qr.png">Download QR</a>
              </div>
            </div>
          </div>
        </div>

      </div>
    </div>

    <!-- Existing stops -->
    <div class="card mb-4">
      <div class="card-body">
        <h5 class="card-title">Existing Bus Stops</h5>
        <button id="refreshStopsBtn" class="btn btn-secondary mb-2">Refresh List</button>
        <div class="table-responsive">
          <table class="table">
            <thead>
              <tr>
                <th>Stop ID</th>
                <th>Name</th>
                <th>Vehicles</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody id="stopListTbody"></tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- Lost bag reports -->
    <div class="card mb-4">
      <div class="card-body">
        <h5 class="card-title">Lost Bag Reports (Live)</h5>
        <div class="table-responsive">
          <table class="table table-sm">
            <thead>
              <tr><th>Time</th><th>Bus</th><th>Description</th><th>User Location</th><th>Actions</th></tr>
            </thead>
            <tbody id="lostBagTbody"></tbody>
          </table>
        </div>
      </div>
    </div>

  </main>

  <div class="toast-container position-fixed top-0 end-0 p-3"></div>

  <!-- Firebase + libs -->
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>

  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

  <!-- QR library -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>

  <!-- Admin JS -->
  <script src="public-tran-admin.js"></script>
</body>
</html>
